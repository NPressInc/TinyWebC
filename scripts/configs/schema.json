{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://tinyweb.network/schemas/network-config.json",
  "title": "Network Configuration",
  "description": "Configuration schema for initializing a TinyWeb gossip network",
  "type": "object",
  "required": ["network", "nodes", "users"],
  "properties": {
    "network": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Human-readable name for the network"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Optional description of the network"
        },
        "type": {
          "type": "string",
          "enum": ["family", "corporate", "educational", "community", "gaming", "custom"],
          "default": "custom",
          "description": "Type of organization this network serves"
        }
      }
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^node_[0-9]{2}$",
            "description": "Unique identifier for the node"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "description": "Human-readable name for the node"
          },
          "hostname": {
            "type": "string",
            "format": "hostname",
            "description": "Optional hostname (generated by docker_config_generator for Tailscale/DNS modes, user-provided for static mode)"
          },
          "gossip_port": {
            "type": "integer",
            "minimum": 1024,
            "maximum": 65535,
            "description": "Optional gossip port (auto-assigned as 9000 by docker_config_generator)"
          },
          "api_port": {
            "type": "integer",
            "minimum": 1024,
            "maximum": 65535,
            "description": "Optional API port (auto-assigned as 8000 by docker_config_generator)"
          },
          "peers": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[^:]+(:[0-9]{1,5})?$",
              "description": "Peer endpoint in hostname[:port] format"
            },
            "default": []
          },
          "tags": {
            "type": "string",
            "description": "Optional metadata such as Tailscale tags"
          }
        }
      }
    },
    "users": {
      "type": "object",
      "required": ["admins", "members"],
      "properties": {
        "admins": {
          "type": "array",
          "minItems": 1,
          "maxItems": 10,
          "items": {
            "$ref": "#/definitions/admin"
          }
        },
        "members": {
          "type": "array",
          "minItems": 0,
          "maxItems": 50,
          "items": {
            "$ref": "#/definitions/member"
          }
        },
        "contacts": {
          "type": "array",
          "minItems": 0,
          "maxItems": 100,
          "items": {
            "$ref": "#/definitions/contact"
          }
        }
      }
    },
    "security": {
      "type": "object",
      "properties": {
        "encryption": {
          "type": "object",
          "properties": {
            "algorithm": {
              "type": "string",
              "enum": ["Ed25519", "RSA-2048", "RSA-4096"],
              "default": "Ed25519"
            },
            "key_rotation_days": {
              "type": "integer",
              "minimum": 1,
              "maximum": 365,
              "default": 90
            }
          }
        },
        "content_filtering": {
          "type": "object",
          "properties": {
            "default_policy": {
              "type": "string",
              "enum": ["allow_all", "block_unknown", "admin_approval"],
              "default": "block_unknown"
            },
            "categories": {
              "type": "object",
              "additionalProperties": {
                "type": "string",
                "enum": ["allow", "block", "allow_with_limits", "admin_approval", "time_limited"]
              }
            }
          }
        }
      }
    },
    "features": {
      "type": "object",
      "properties": {
        "messaging": {
          "type": "object",
          "additionalProperties": {"type": "boolean"}
        },
        "location": {
          "type": "object", 
          "additionalProperties": {"type": "boolean"}
        },
        "content": {
          "type": "object",
          "additionalProperties": {"type": "boolean"}
        }
      }
    },
    "initial_transactions": {
      "type": "object",
      "additionalProperties": {"type": "boolean"}
    },
    "extensions": {
      "type": "array",
      "description": "Optional: Extension services (Jellyfin, Immich, etc.) to run alongside core nodes. Reserved for future dashboard integration.",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique extension identifier (e.g., 'jellyfin', 'immich')"
          },
          "name": {
            "type": "string",
            "description": "Human-readable extension name"
          },
          "docker_image": {
            "type": "string",
            "description": "Docker image for the extension service"
          },
          "ports": {
            "type": "object",
            "description": "Port mappings for the extension (e.g., {'web': 8096, 'api': 8097})"
          },
          "bridge_endpoint": {
            "type": "string",
            "description": "API endpoint path for core â†” extension communication (e.g., '/api/jellyfin')"
          },
          "enabled": {
            "type": "boolean",
            "default": false,
            "description": "Whether this extension is enabled (managed by dashboard)"
          }
        }
      }
    },
    "docker": {
      "type": "object",
      "description": "Docker deployment configuration",
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["production", "test"],
          "description": "Deployment mode"
        },
        "discovery": {
          "type": "object",
          "required": ["mode", "hostname_prefix"],
          "properties": {
            "mode": {
              "type": "string",
              "enum": ["tailscale", "dns_pattern", "static"],
              "description": "Peer discovery mechanism"
            },
            "hostname_prefix": {
              "type": "string",
              "description": "Prefix for hostname generation (e.g., 'tw_node', 'smithfam_tw_node')"
            },
            "dns_pattern": {
              "type": "object",
              "properties": {
                "pattern": {
                  "type": "string",
                  "description": "Optional DNS pattern (e.g., 'tw_node*.tinyweb.win')"
                },
                "domain": {
                  "type": "string",
                  "description": "Required if pattern not provided (e.g., 'tinyweb.win', 'duckdns.org')"
                }
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "admin": {
      "type": "object",
      "required": ["id", "name", "role"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^admin_[0-9]{3}$"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "role": {
          "type": "string",
          "enum": ["admin"]
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Optional email for external communication"
        }
      }
    },
    "member": {
      "type": "object", 
      "required": ["id", "name", "role"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^member_[0-9]{3}$"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "role": {
          "type": "string",
          "enum": ["member"]
        },
        "age": {
          "type": "integer",
          "minimum": 0,
          "maximum": 150
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Optional email for external communication"
        },
        "supervised_by": {
          "type": "array",
          "minItems": 0,
          "items": {
            "type": "string",
            "pattern": "^admin_[0-9]{3}$"
          }
        }
      }
    },
    "contact": {
      "type": "object",
      "required": ["id", "name", "role"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^contact_[0-9]{3}$"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "role": {
          "type": "string",
          "enum": ["contact", "peer", "friend", "colleague", "external"]
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "organization": {
          "type": "string",
          "maxLength": 100
        },
        "trusted": {
          "type": "boolean",
          "default": false
        }
      }
    }
  }
} 