syntax = "proto3";

package tinyweb;

// ===== PHASE 1: MVP Core Functionality =====

// --- User Management ---
message UserRegistration {
  bytes user_pubkey = 1;           // 32 bytes Ed25519
  string display_name = 2;
  uint32 role = 3;                 // 0=parent, 1=child, 2=community
  bytes parent_pubkey = 4;         // Optional: child's parent
  uint64 age = 5;                  // Optional: for age-based controls
}

message RoleAssignment {
  bytes target_user = 1;           // User receiving role
  uint32 new_role = 2;             // New role to assign
  string reason = 3;               // Optional reason
}

// --- Communication ---
message DirectMessage {
  string text = 1;
  bytes media_ref = 2;             // Optional reference id or small blob
  uint64 reply_to_timestamp = 3;  // Optional: reference to message being replied to
}

message GroupMessage {
  string text = 1;
  bytes group_id = 2;              // 16 bytes
  bytes media_ref = 3;             // Optional
  uint64 reply_to_timestamp = 4;
}

// --- Group Management ---
message GroupCreate {
  bytes group_id = 1;              // 16 bytes, generated by creator
  string group_name = 2;
  string description = 3;
  repeated bytes initial_members = 4; // 32 bytes each
  uint32 group_type = 5;           // 0=family, 1=friends, 2=community
}

message GroupUpdate {
  bytes group_id = 1;
  string new_name = 2;             // Optional
  string new_description = 3;      // Optional
  bytes new_avatar = 4;            // Optional
}

message GroupMemberAdd {
  bytes group_id = 1;
  bytes new_member = 2;            // 32 bytes pubkey
  uint32 member_role = 3;          // 0=admin, 1=member, 2=readonly
}

message GroupMemberRemove {
  bytes group_id = 1;
  bytes member_to_remove = 2;
  string reason = 3;               // Optional
}

message GroupMemberLeave {
  bytes group_id = 1;
  string farewell_message = 2;     // Optional
}

// --- Safety & Control ---
message PermissionEdit {
  bytes target_user = 1;           // User whose permissions are changing
  string permission_type = 2;      // e.g., "can_message", "can_create_groups"
  bool granted = 3;                // true=grant, false=revoke
  uint64 expires_at = 4;           // 0 = permanent
}

message ParentalControl {
  bytes child_user = 1;
  string control_type = 2;         // "screen_time", "app_access", "content_rating"
  string control_value = 3;        // JSON or simple value
  bool enabled = 4;
}

message ContentFilter {
  bytes target_user = 1;
  repeated string blocked_keywords = 2;
  repeated string allowed_domains = 3;
  uint32 content_rating_max = 4;  // Max allowed content rating
  bool block_explicit = 5;
}

message LocationUpdate {
  double lat = 1;
  double lon = 2;
  uint32 accuracy_m = 3;
  uint64 timestamp = 4;
  string location_name = 5;        // Optional: "Home", "School", etc.
}

message EmergencyAlert {
  uint32 alert_type = 1;           // 1=medical, 2=safety, 3=fire, 4=other
  string message = 2;
  double lat = 3;                  // Current location
  double lon = 4;
  bytes contact_info = 5;          // Optional emergency contact
}

// --- Network Management ---
message NodeRegistration {
  bytes node_pubkey = 1;           // 32 bytes
  string node_address = 2;         // IP or DNS
  uint32 node_port = 3;           // Gossip port (default: 9000)
  uint32 api_port = 4;             // HTTP API port (default: 8000)
  string node_version = 5;
  bytes stake_proof = 6;           // Optional: proof of stake/commitment
}

message SystemConfig {
  string config_key = 1;           // e.g., "max_message_size", "retention_days"
  string config_value = 2;
  uint32 requires_consensus = 3;   // 0=no, 1=yes
}

// --- Access Control ---
message AccessRequest {
  bytes resource_id = 1;           // Resource being requested
  string resource_type = 2;        // "file", "album", "group", etc.
  string request_reason = 3;       // Optional
  uint64 duration_seconds = 4;     // 0 = permanent
}

// ===== PHASE 2: Enhanced Communication & Media =====

message VoiceCallRequest {
  bytes caller_id = 1;
  bytes callee_id = 2;
  string call_type = 3;            // "voice", "video"
  bytes session_id = 4;            // Unique call session identifier
}

message MediaDownload {
  bytes media_id = 1;
  string media_type = 2;           // "image", "video", "audio", "document"
  uint64 media_size = 3;
}

message ContentAccessUpdate {
  bytes content_id = 1;
  repeated bytes allowed_users = 2;
  uint64 expires_at = 3;
}

message CreationUpload {
  bytes content_id = 1;
  string content_type = 2;         // "drawing", "story", "video", "craft"
  bytes content_data = 3;          // Small inline data or reference
  string title = 4;
  string description = 5;
  repeated string tags = 6;
}

message CreationShareRequest {
  bytes creation_id = 1;
  repeated bytes share_with = 2;   // Recipients
  bool allow_remix = 3;
}

// ===== PHASE 3: Educational & Family Features =====

message EducationalResourceAdd {
  bytes resource_id = 1;
  string resource_type = 2;        // "book", "video", "quiz", "lesson"
  string title = 3;
  string description = 4;
  uint32 age_rating = 5;           // Minimum age
  repeated string subjects = 6;    // "math", "science", etc.
  bytes content_ref = 7;
}

message ChallengeComplete {
  bytes challenge_id = 1;
  bytes user_id = 2;
  uint32 score = 3;
  uint64 completion_time = 4;
  bytes proof = 5;                 // Optional proof of completion
}

message BookAddToLibrary {
  bytes book_id = 1;
  string title = 2;
  string author = 3;
  bytes cover_image = 4;           // Small thumbnail or reference
  string genre = 5;
  uint32 age_rating = 6;
}

message ChoreAssign {
  bytes chore_id = 1;
  bytes assigned_to = 2;           // Child user
  string chore_name = 3;
  string description = 4;
  uint64 due_date = 5;
  uint32 reward_points = 6;
}

message ChoreComplete {
  bytes chore_id = 1;
  bytes completed_by = 2;
  uint64 completion_time = 3;
  bytes proof_image = 4;           // Optional photo proof
}

message RewardDistribute {
  bytes recipient = 1;
  uint32 points = 2;
  string reward_type = 3;          // "chore", "achievement", "bonus"
  string reason = 4;
}

// ===== PHASE 4: Advanced Features =====

message GeofenceCreate {
  bytes geofence_id = 1;
  string name = 2;                 // "Home", "School", "Safe Zone"
  double center_lat = 3;
  double center_lon = 4;
  uint32 radius_m = 5;
  repeated bytes monitored_users = 6;
}

message GeofenceConfigUpdate {
  bytes geofence_id = 1;
  bool alert_on_enter = 2;
  bool alert_on_exit = 3;
  repeated bytes alert_recipients = 4;
}

message UsagePolicyUpdate {
  bytes target_user = 1;
  string policy_type = 2;          // "quiet_time", "max_daily_hours", "bedtime"
  string policy_value = 3;         // Time ranges, limits, etc.
  repeated uint32 days_of_week = 4; // 0=Sun, 1=Mon, etc.
}

message GameSessionStart {
  bytes session_id = 1;
  string game_name = 2;
  repeated bytes players = 3;
  uint32 max_duration = 4;         // Minutes
}

message GamePermissionUpdate {
  bytes target_user = 1;
  string game_id = 2;
  bool allowed = 3;
  uint32 max_daily_minutes = 4;
}

message EventCreate {
  bytes event_id = 1;
  string title = 2;
  string description = 3;
  uint64 start_time = 4;
  uint64 end_time = 5;
  string location = 6;
  repeated bytes invited_users = 7;
}

message EventInvite {
  bytes event_id = 1;
  bytes invitee = 2;
  string personal_message = 3;
}

message EventRSVP {
  bytes event_id = 1;
  uint32 response = 2;             // 0=no, 1=yes, 2=maybe
  string comment = 3;
}

message CommunityPostCreate {
  bytes post_id = 1;
  string title = 2;
  string content = 3;
  repeated string tags = 4;
  bytes media_ref = 5;
}

message SharedAlbumCreate {
  bytes album_id = 1;
  string album_name = 2;
  repeated bytes shared_with = 3;
  bool allow_contributions = 4;
}

message MediaAddToAlbumRequest {
  bytes album_id = 1;
  bytes media_id = 2;
  string caption = 3;
}

message CollaborativeProjectCreate {
  bytes project_id = 1;
  string project_name = 2;
  string project_type = 3;         // "art", "story", "music", "code"
  repeated bytes collaborators = 4;
  bytes project_data = 5;
}

